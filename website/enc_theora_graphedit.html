<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <title>Encoding Ogg Vorbis + Theora files</title>
  <meta name="description" content="Directshow Ogg demuxer/muxer with vorbis, speex, FLAC and theora decoders and vorbis, speex encoders.">
  <meta name="keywords" content="directshow, theora, vorbis, speex, ogg, media player, flac, codec, windows, audio, video, wmp, directX, plugin, plug-in, 
decoder, encoder, demux, mux, demuxer">
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#FF00FF" alink="#FF0000">
<a href="http://www.illiminable.com/ogg">Main Page</a><br><br>
<b><u><font size="+2">How to encode theora files with directshow</font></u></b><br>
This brief tutorial explains how to use the directshow filter in association with graphedit to encode or transcode ogg theora. It focuses mainly on transcoding, but by using different source filters you can also encode raw data.<br>
Graphedit is available in the DirectX9 SDK<br>
<br>

<u><b>Step 1a - Load File</b></u><br>
After loading up graphedit, from the file menu choose "Render Media File..." and browse to select the file you want to transcode<br>
<br><img src="http://www.illiminable.com/ogg/images/select_render_file.JPG" alt="Select render file from the menu">
<br>
<br>

<u><b>Step 1b - Rendered Graph</b></u><br>
If it was successful, you should now have a fully rendered graph, that looks something like this. The exact filters will depends on your source file.<br>
<br><img src="http://www.illiminable.com/ogg/images/show_rendered_graph.JPG" alt="This is the rendered graph">
<br>
<br>

<u><b>Step 2a - Check media types</b></u><br>
Right click on the pin that inputs to the video renderer, and choose pin properties.<br>
<br><img src="http://www.illiminable.com/ogg/images/pin_properties.JPG" alt="Select pin proeprties">
<br>
<br>


<u><b>Step 2b - Ensure YV12 or YUY2</b></u><br>
On the pin properties page check the media type is either YV12 or YUY2, if it is not, this file can not yet be transcoded directly. If it is then proceed.<br>
<br><img src="http://www.illiminable.com/ogg/images/ensure_YV12.JPG" alt="Select pin properties">
<br>
<br>


<u><b>Step 3 - Remove renderers</b></u><br>
This has rendered a graph for playback, what we want to do is remove the renderers from the graph, and replace them with our encoders and muxer. To remove the renderers click on them, they will get a blue border, then press the delete key. After removing the renderers, the graph should look something like this.<br>
<br><img src="http://www.illiminable.com/ogg/images/remove_renderers.JPG" alt="This is the rendered graph">
<br>
<br>


<u><b>Step 4 - Find encoders</b></u><br>
The first time you will need to find the encoders, by clicking the add filter icon, then selecting the directshow branch of the tree.<br>
<br><img src="http://www.illiminable.com/ogg/images/find_encoders.JPG" alt="Find the encoders">
<br>
<br>

<u><b>Step 5a - Select encoders</b></u><br>
Find the vorbis encode filter and the theora encode filter, select each one and check the favourite filter box so next time the filter will be under favourites in the menu, click insert filter.<br>
<br><img src="http://www.illiminable.com/ogg/images/select_encoders.JPG" alt="Select the encoders">
<br>
<br>

<u><b>Step 5b - Encoders Added to graph</b></u><br>
After the encoders have been added to the graph, it should look something like this.<br>
<br><img src="http://www.illiminable.com/ogg/images/encoders_added.JPG" alt="Graph after encoders added.">
<br>
<br>

<u><b>Step 6 - Connect the encoders</b></u><br>
By dragging the ouput pin of the decoder to the input of the encoder connect the filters together.<br>
<br><img src="http://www.illiminable.com/ogg/images/connect_encoders.JPG" alt="Connecting encoder pins.">
<br>
<br>

<u><b>Step 7 - Open the Theora Encoder Properties</b></u><br>
Important: *BEFORE* connecting to the muxer, right click the filter and select it's proeprty page.<br>
<br><img src="http://www.illiminable.com/ogg/images/filter_properties.JPG" alt="Selecting filter proeprties menu item.">
<br>
<br>

<u><b>Step 8 - Setup the encoder properties</b></u><br>
Modify the settings and click apply or ok. Future versions will include more comprehensive options<br>
<br><img src="http://www.illiminable.com/ogg/images/theora_properties.JPG" alt="Select encoding parameters.">
<br>
<br>

<u><b>Step 9 - Select Mux Filter</b></u><br>
Select the Ogg Mux filter as you previously did for the encoders and connect the encoders to it. As you connect a pin a new one will be spawned.<br>
Important: Whichever encoder is connected at *the bottom* is one that will appear *first* in the encoded file. <b>This means to make a valid theora file, the vorbis stream is added first to the top pin, then the theora stream to the next pin.</b><br>
<br><img src="http://www.illiminable.com/ogg/images/select_muxer.JPG" alt="Select Muxer.">
<br>
<br>

<u><b>Step 10 - Fully connected graph to play</b></u><br>
The graph is now ready to go, and should look something like this. Press the play button and wait for the encoding to finish. It is finished when the play button goes green again. Close graphedit... don't press play again or it will overwrite the file. Depending on the source format it may show encoding progress in the progress bar, this is however slightly innacurate... the bar will appear to finish before the encoding has really finished. The progress bar indicates how much data has left the source. Look at the play button or check your processor to usage to see if it has finished.There will always be one empty pin at the bottom of the muxer, this is normal.<br>
<br><img src="http://www.illiminable.com/ogg/images/fully_connected.JPG" alt="Fully Connected graph">
<br>
<br>
<a href="http://www.illiminable.com/ogg">Main Page</a><br><br>

</body>
</html>